<ui:composition
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<h:outputScript library="js" name="tag-it.js"></h:outputScript>
	<h:outputStylesheet library="css" name="jquery.tagit.css"></h:outputStylesheet>
	<h:outputStylesheet library="css" name="tagit.ui-zendesk.css"></h:outputStylesheet>
	
	<script>
		
		function allActors(a) {
			$('#movieForm\\:actorName').tagit({
				availableTags: a,
				allowSpaces: true
			});
		}
		
		$(document).on("change","input[type=radio]", function(){
			var rad=$('[name="movieForm:radioLocationType"]:checked').val();
			switch (rad){
				case '1':
					$('[name="movieForm:movieTrailer"]').hide();
					$('[name="movieForm:movieUpload"]').show();
					break;
				case '2':
					$('[name="movieForm:movieTrailer"]').show();
					$('[name="movieForm:movieUpload"]').hide();
					break;
			}
		});
		
		$(document).ready(function(){
			var rad=$('[name="movieForm:radioLocationType"]:checked').val();
			switch (rad){
				case '1':
					$('[name="movieForm:movieTrailer"]').hide();
					break;
				case '2':
					$('[name="movieForm:movieUpload"]').hide();
					break;
			}
		});
	</script>

	<h:form id="movieForm" enctype="multipart/form-data">
		<h:panelGrid columns="1" width="600">
			<p:rating stars="10" rendered="#{movie.userHasMovie.rate == null}">
				<f:ajax event="rate" listener="#{movie.onRate}"  />
			</p:rating>
			
			#{msg.movieTitle}:
			<h:outputText value="#{movie.movieSelected.title}" rendered="#{not movie.editable}" />
			<h:inputText value="#{movie.movieEdit.title}" rendered="#{movie.editable}" />
			
			#{msg.movieReleaseDate}:
			<h:outputText value="#{movie.movieSelected.releaseDate.time}" rendered="#{not movie.editable}">
				<f:convertDateTime type="date" dateStyle="long" pattern="dd.MM.yyyy." />
			</h:outputText>
	        <p:calendar value="#{movie.movieEdit.releaseDate}" rendered="#{movie.editable}"
      				pattern="dd.MM.yyyy." showOn="button" navigator="true" />
	        				
			#{msg.movieActors}:
			<ui:repeat value="#{movie.movieSelected.actors}" var="actor">
				<h:outputText value="#{actor}" rendered="#{not movie.editable}" />
				<h:outputText value=" | " rendered="#{not movie.editable}" />
			</ui:repeat>
			
			<h:dataTable border="1" value="#{movie.movieEdit.actors}" var="a" 
						rendered="#{movie.editable}">
				<h:column>
					<h:outputText value="#{a}" />
				</h:column>
				<h:column>
					<h:commandLink value="#{msg.delete}" action="#{movie.deleteActor(a)}" />
				</h:column>
			</h:dataTable>
	
			<h:outputLabel for="actorName" value="#{msg.actorSelection}:" rendered="#{movie.editable}" />
			<h:inputText id="actorName" value="#{movie.actorName}" 
							onfocus="allActors(#{movie.actorsString})" rendered="#{movie.editable}" />
			<h:message for="actorName" style="color: red" rendered="#{movie.editable}" />
			
			#{msg.movieStoryline}:
			<h:outputText value="#{movie.movieSelected.storyline}" rendered="#{not movie.editable}" />
			<h:inputText value="#{movie.movieEdit.storyline}" rendered="#{movie.editable}" />
	
			#{msg.movieGenres}:
			<ui:repeat value="#{movie.movieSelected.genres}" var="gen">
				<h:outputText value="#{gen.name}" rendered="#{not movie.editable}" />
				<h:outputText value=" | " rendered="#{not movie.editable}" />
			</ui:repeat>
			
			<h:selectManyListbox id="movieGenres"  value="#{movie.selectedGenres}" rendered="#{movie.editable}">
				<f:selectItem itemValue="#{null}" itemLabel="-- select --" />
				<f:selectItems value="#{movie.genresAllList}" var="g" 
								itemValue="#{g.id}" itemLabel="#{g.name}" />
			</h:selectManyListbox>
	        <h:message for="movieGenres" rendered="#{movie.editable}" />
				
				
				
			<h:outputLabel value="#{msg.movieTrailer}:" rendered="#{not movie.editable}"/>
			<h:outputLink value="#{movie.movieSelected.trailerLocation}" target="_blank" 
							rendered="#{movie.movieSelected.trailerLocationType == 2 and movie.movieSelected.trailerLocation != null and !movie.editable}">
				<h:outputText value="#{msg.movieTrailerWatch}" /> 
			</h:outputLink>
			<video controls="controls"  style="display:#{(movie.movieSelected.trailerLocationType == 1 and !movie.editable)?'block':'none'}">
				<source src="/trailer/#{movie.movieSelected.trailerLocation}" type="video/mp4" />
			</video>
			
			
			<h:outputLabel value="#{msg.movieTrailer}:" rendered="#{login.user.privilege lt 3 and movie.editable}"/>
			<h:panelGroup rendered="#{login.user.privilege lt 3 and movie.editable}">
				<h:selectOneRadio id="radioLocationType" value="#{movie.movieEdit.trailerLocationType}" rendered="#{login.user.privilege lt 3}">
					<f:selectItem itemValue="1" itemLabel="#{msg.radioLocationTypeVideo}"></f:selectItem>
					<f:selectItem itemValue="2" itemLabel="#{msg.radioLocationTypeYoutube}"></f:selectItem>
				</h:selectOneRadio>
			</h:panelGroup> 
			<h:message for="rodioLocationType" rendered="#{login.user.privilege lt 3 and movie.editable}" />
			<h:panelGroup rendered="#{login.user.privilege lt 3 and movie.editable}">
				<h:inputText id="movieTrailer" value="#{movie.movieEdit.trailerLocation}" />
				<h:inputFile id="movieUpload" value="#{movie.moviePart}"  rendered="#{login.user.privilege lt 3}" />
			</h:panelGroup>
			<h:message for="movieTrailer" rendered="#{movie.editable}" />
					
			
			#{msg.movieRuntime}:
			<h:outputText value="#{movie.movieSelected.runtimeMinutes}" rendered="#{not movie.editable}" />
			<h:inputText value="#{movie.movieEdit.runtimeMinutes}" rendered="#{movie.editable}" />
	
			#{msg.movieRate}:
			<h:outputText value="#{movie.movieSelected.rate}"></h:outputText>		
			
			<h:commandButton value="#{msg.delete}" action="#{movie.delete()}" rendered="#{not movie.editable}"/>
			<h:commandButton value="#{msg.edit}" action="#{movie.edit()}" rendered="#{not movie.editable}"/>
			<h:commandButton value="#{msg.save}" action="#{movie.save()}" rendered="#{movie.editable}" />
			<h:commandButton value="#{msg.cancel}" action="#{movie.cancel()}" rendered="#{movie.editable}" />
		</h:panelGrid>	
	</h:form>	
</ui:composition>
